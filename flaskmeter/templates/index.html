{% extends 'base.html' %}

{% set title = 'CPU & Memory Usage' %}

{% block title %}Flaskmeter - CPU & Mem{% endblock %}

{% block main %}
    <script src="https://cdn.socket.io/socket.io-1.3.7.js"></script>
    <script type="text/javascript" charset="utf-8">
        $(document).ready(function(){
          namespace = '/test'; // change to an empty string to use the global namespace

          // the socket.io documentation recommends sending an explicit package upon connection
          // this is specially important when using the global namespace
          var socket = io.connect('http://' + document.domain + ':' + location.port + namespace);

          // event handler for server sent data
          // the data is displayed in the  "Received" section of the page
          socket.on('my response', function(msg) {
              $('#cpu').val(msg.cpu.toFixed(1) + " %");
              $('#mem').val(msg.mem.toFixed(1) + " %");
              graphs[0].data[0].x.push(msg.time);
              graphs[0].data[0].y.push(msg.cpu);
              graphs[0].data[1].x.push(msg.time);
              graphs[0].data[1].y.push(msg.mem);
              Plotly.redraw(ids[0])
          });

          socket.on('clicked_back', function(msg) {
            var isChecked = msg.clicked;
            $('#received').attr('checked', isChecked);
          });

          $("#mycheckbox").change(function() {// the first checking checkbox
            var isChecked = $('#mycheckbox').attr('checked') != undefined;
            socket.emit('clicked', {data: isChecked});
          });

        });
    </script>

    <legend> {{ title }} </legend>
    <div class="well">
      <div class="row">
        <form class="form-horizontal">
          <div class="form-group">
            <label for="cpu" class="col-md-2 control-label">CPU Usage:</label>
            <div class="col-md-3">
              <input class="form-control" type="text" id="cpu" value="100" readonly>
            </div>
          </div>
          <div class="form-group">
            <label for="mem" class="col-md-2 control-label">Memory Usage:</label>
            <div class="col-md-3">
              <input class="form-control" type="text" id="mem" readonly>
            </div>
          </div>
        </form>
      </div>
      {% for id in ids %}
        <div id="{{id}}">
        </div>
      {% endfor %}
    </div>

    <!-- D3.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
    <!-- Plotly.js -->
    <script src="https://d14fo0winaifog.cloudfront.net/plotly-basic.js"></script>

    <script type="text/javascript">

        var graphs = {{graphJSON | safe}};
        var ids = {{ids | safe}};

        for(var i in graphs) {
            Plotly.plot(ids[i], // the ID of the div, created above
                        graphs[i].data,
                        graphs[i].layout || {});

        }

    </script>

{% endblock %}

<footer>

</footer>
